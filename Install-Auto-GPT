#!/bin/bash

# PrÃ¼fen, ob das Paket 'zip' installiert ist, andernfalls installieren
if ! command -v zip &> /dev/null; then
    echo "'zip' Paket nicht gefunden. Es wird nun installiert..."
    sudo apt-get update
    sudo apt-get install -y zip
fi

# ChatGPT-Verzeichnis erstellen
mkdir -p /pfad/zum/chatgpt

# ChatGPT von GitHub herunterladen und entpacken
wget -O /pfad/zum/chatgpt/chatgpt.zip https://github.com/dein/repo/archive/refs/heads/main.zip
unzip /pfad/zum/chatgpt/chatgpt.zip -d /pfad/zum/chatgpt
rm /pfad/zum/chatgpt/chatgpt.zip

# Virtual Environment erstellen und aktivieren
python3 -m venv /pfad/zum/chatgpt/venv
source /pfad/zum/chatgpt/venv/bin/activate

# Erforderliche Python-Pakete installieren
pip install -r /pfad/zum/chatgpt/repo-main/requirements.txt

# API-Zugriffsdaten konfigurieren
echo "export OPENAI_API_KEY='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'" >> /pfad/zum/chatgpt/venv/bin/activate

# Autostart-Konfiguration erstellen
autostart_file="/etc/systemd/system/chatgpt.service"
echo "[Unit]" | sudo tee $autostart_file
echo "Description=ChatGPT Autostart" | sudo tee -a $autostart_file
echo "After=network.target" | sudo tee -a $autostart_file
echo "" | sudo tee -a $autostart_file
echo "[Service]" | sudo tee -a $autostart_file
echo "ExecStart=/pfad/zum/chatgpt/venv/bin/python /pfad/zum/chatgpt/repo-main/main.py" | sudo tee -a $autostart_file
echo "WorkingDirectory=/pfad/zum/chatgpt/repo-main" | sudo tee -a $autostart_file
echo "Restart=always" | sudo tee -a $autostart_file
echo "User=chat" | sudo tee -a $autostart_file
echo "" | sudo tee -a $autostart_file
echo "[Install]" | sudo tee -a $autostart_file
echo "WantedBy=multi-user.target" | sudo tee -a $autostart_file

# Autostart-Service aktivieren
sudo systemctl enable chatgpt.service

echo "ChatGPT wurde erfolgreich installiert und der Autostart wurde
